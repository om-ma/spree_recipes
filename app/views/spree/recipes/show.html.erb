<% @body_id = 'recipe-details' %>
    <main class="page-contents">
      <div class="row no-gutters">
        <div class="col-xl-1 col-lg-2 phone-hide"></div>
        <div class="col-xl-10 col-lg-8">
          <div class="recipe-details-wrapper">
            <ol class="breadcrumb">
              <%= spree_recipe_breadcrumbs(@taxon, "", @recipe) %>
            </ol>
            <div class="ratings">
              <%= image_tag asset_path("star.svg"), alt: "star" %>
              <%= image_tag asset_path("star.svg"), alt: "star" %>
              <%= image_tag asset_path("star.svg"), alt: "star" %>
              <%= image_tag asset_path("star.svg"), alt: "star" %>
              <%= image_tag asset_path("star.svg"), alt: "star" %>
              <span>5 Reviews</span>
            </div>
            <div class="row">
              <div class="col-xl-6">
                <div class="recipe-gallery-wrap">
                  <div id="gallery-slider" class="carousel slide" data-ride="carousel">
                    <div class="carousel-inner">
                      <% if @recipe.recipe_icons.present? %>
                        <% @recipe.recipe_icons.each_with_index do |recipe_icon, index| %>
                          <% if recipe_icon.attachment.blob.present? %>
                            <div class="carousel-item <%= 'active' if index == 0 %>">
                              <img class="d-block w-100" src="<%= main_app.url_for(recipe_icon.my_cf_image_url(:plp)) %>" alt="Image <%= index + 1 %>">
                            </div>
                          <% end %>
                        <% end %>
                      <% end %>
                      <% if @recipe.recipe_videos.present? %>
                        <% @recipe.recipe_videos.each_with_index do |video, index| %>
                          <div class="carousel-item <%= 'active' if index == @recipe&.recipe_icons&.size %>">
                            <div class="embed-responsive embed-responsive-16by9">
                              <iframe class="embed-responsive-item"
                                src="<%= video.video_url %>"
                                allowfullscreen></iframe>
                            </div>
                          </div>
                        <% end %>
                      <% end %>
                    </div>

                    <!-- Carousel Indicators -->
                    <ol class="carousel-indicators">
                      <% if @recipe.recipe_icons.present? %>
                        <% @recipe.recipe_icons.each_with_index do |recipe_icon, index| %>
                          <% if recipe_icon.attachment.blob.present? %>
                            <li data-target="#gallery-slider" data-slide-to="<%= index %>" class="<%= 'active' if index == 0 %>">
                              <img src="<%= main_app.url_for(recipe_icon.my_cf_image_url(:thumb)) %>" alt="Thumbnail <%= index + 1 %>">
                            </li>
                          <% end %>
                        <% end %>
                      <% end %>
                      <% if @recipe.recipe_videos.present? %>
                        <% @recipe.recipe_videos.each_with_index do |video, index| %>
                          <% youtube_id = video.video_url.split('v=')&.last %>
                          <% thumbnail_url = "https://img.youtube.com/vi/#{youtube_id}/hqdefault.jpg" %>
                          <li data-target="#gallery-slider" data-slide-to="<%= (@recipe&.recipe_icons&.size || 0) + index %>" class="<%= 'active' if index == 0 %>">
                            <img src="<%= thumbnail_url %>" alt="Video Thumbnail <%= index + 1 %>">
                          </li>
                        <% end %>
                      <% end %>
                    </ol>
                </div>
                </div>
              </div>
              <div class="col-xl-6">
                <h1 class="title mb-40"><%= @recipe.name %></h1>
                <% if @recipe.ingredients.present? %>
                <div class="product-ingredients">
                  <h5>Ingredients</h5>
                  <ul>
                    <% @recipe.ingredients.each do |ingredient| %>
                    <li>
                      <%= ingredient.name %>
                      <% if ingredient.variant.present? %>
                        <% product = ingredient.variant.product %>
                        <%= link_to spree.product_path(product) , class: "ml-1", data: { turbolinks: false } do %>
                          <%= product.name %>
                        <% end %>
                      <% end %>
                    </li>
                  <% end %>
                 </ul>
                </div>
                <%end%>
                <%= @recipe&.description&.html_safe %>
                <% if @recipe.instructions.present? %>
                  <div class="product-ingredients">
                    <h5>Instructions</h5>
                    <ol>
                      <% @recipe.instructions.each do |instruction| %>
                    <li>
                      <%= instruction.description %>
                    </li>
                  <% end %>
                    </ol>
                  </div>
                 <% end %> 
                <div class="mt-40">
                  <%= link_to "SHOP THE FLAVOR", display_recipe_products_modal_path(@recipe), class: "btn btn-primary", remote: true, id: "js-recipe-product-modal" %>
                  <%= link_to "Print / save recipe", recipe_pdf_path(@recipe, format: :pdf), class: "ml-sm-2 mt-2 mt-sm-0 btn btn-primary", target: '_blank' %>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="col-xl-1 col-lg-2 phone-hide"></div>
      </div>
    </main>
    <!-- ./page contents -->

    <!-- footer -->
    <footer class="footer-wrapper">
      <div class="footer-links-wrap">
        <div class="row no-gutters">
          <div class="col-xl-2 tablet-hide"></div>
          <div class="col-xl-2 col-lg-4">
            <div class="footer-logo-wrap">
              <figure><img src="assets/images/footer-logo.svg" alt="Newport Flavors &amp; Fragrances"></figure>
              <p>Family owned and run for over 40 years. It is our mission to spread the Natural and Organic bounty of
                nature through our products.</p>
            </div>
            <ul class="footer-nav">
              <li class="header">Information</li>
              <li><a href="#">About Us</a></li>
              <li><a href="#">Blog</a></li>
              <li><a href="#">Best Sellers</a></li>
              <li><a href="#">Contact Us</a></li>
              <li><a href="#">New Products</a></li>
              <li><a href="#">Shipping</a></li>
              <li><a href="#">Support</a></li>
              <li><a href="#">Terms and Conditions</a></li>
              <li><a href="#">Privacy</a></li>
              <li><a href="#">Returns &amp; Replacements</a></li>
              <li><a href="#">*Site Map*</a></li>
            </ul>
          </div>
          <div class="col-xl-2 col-lg-4">
            <div class="footer-newsletter">
              <h4>Sign up for updates</h4>
              <form>
                <input type="text" class="form-control" placeholder="Enter your email">
                <button type="submit" class="icon-btn">Submit</button>
              </form>
              <div class="newsletter-msg">Be the first to learn about promotions special events, new arrivals and more.
              </div>
            </div>
            <ul class="footer-nav">
              <li class="header">My Account</li>
              <li><a href="#">My Account</a></li>
              <li><a href="#">My Orders</a></li>
              <li><a href="#">My Credits</a></li>
              <li><a href="#">My Address</a></li>
              <li><a href="#">My Info</a></li>
              <li><a href="#">My Wish List</a></li>
            </ul>
            <ul class="footer-nav">
              <li class="header">Our Brands</li>
              <li><a href="#">Naturlax</a></li>
              <li><a href="#">Yum Matcha</a></li>
              <li><a href="#">Seelect Tea</a></li>
            </ul>
          </div>
          <div class="col-xl-2 col-lg-4">
            <div class="footer-spacer"></div>
            <ul class="footer-nav">
              <li class="header">Product Info</li>
              <li><a href="#">Flavor Powders</a></li>
              <li><a href="#">Flavor Emulsions</a></li>
              <li><a href="#">Flavor Concentrates</a></li>
              <li><a href="#">Flavor Extracts</a></li>
              <li><a href="#">Flavor Oils</a></li>
              <li><a href="#">The Flavor Guy Videos</a></li>
              <li><a href="#">Reviews</a></li>
              <li><a href="#">FAQs</a></li>
            </ul>
          </div>
          <div class="col-xl-2 col-lg-12">
            <div class="row-tablet-only">
              <div class="col-md-4 col-12">
                <h4>Follow us</h4>
                <ul class="social-nav d-flex flex-wrap align-items-center">
                  <li><a href="#" class="facebook-icon">Facebook</a></li>
                  <li><a href="#" class="instagram-icon">Intagram</a></li>
                  <li><a href="#" class="pinterest-icon">Pinterest</a></li>
                  <li><a href="#" class="youtube-icon">Youtube</a></li>
                </ul>
              </div>
              <div class="col-lg-4 mobile-hide">
                <div class="footer-address">
                  <h5>Address</h5>
                  <p>833 N. Elm Street, Orange,<br>
                    California 92867</p>
                </div>
                <div class="footer-phone mobile-hide"><a href="tel:1-714-744-3700">1-714-744-3700</a></div>
              </div>
              <div class="col-lg-4 mobile-hide">
                <div class="footere-business-hours">
                  <h5>Business hours</h5>
                  <p>8:00 am - 5:00 pm,<br>
                    Monday - Friday, Pacific Time</p>
                </div>
              </div>
            </div>
          </div>
          <div class="col-xl-2 tablet-hide"></div>
          <!-- end col -->
        </div>
        <div class="banner-grid-wrap">
          <div></div>
          <div></div>
          <div></div>
          <div></div>
          <div></div>
          <div></div>
        </div>
      </div>
      <div class="footer-copyright">
        <div class="row no-gutters">
          <div class="col-xl-2 tablet-hide"></div>
          <div class="col-xl-4 col-lg-6">
            <p>Copyright &copy; 1990-2021 Natures Flavors, Inc. All rights reserved.</p>
          </div>
          <div class="col-xl-4 col-lg-6">
            <div class="accepted-payment d-lg-flex flex-wrap align-items-center justify-content-end">
              <p>Secure payment with</p>
              <figure><img src="assets/images/footer-payment.svg" alt=""></figure>
            </div>
          </div>
          <div class="col-xl-2 tablet-hide"></div>
        </div>
      </div>
    </footer>
    <!-- /.footer -->
  </div>
  <!-- /.wrapper -->

  <!-- cart sidebar -->
  <aside class="cart-sidebar-wrapper">
    <div class="overlay"></div>
    <div class="cart-sidebar">
      <div class="cart-sidebar-header">
        <div class="cart-sidebar-title">My Cart</div>
        <button type="button" class="btn close-sidebar-btn">Close</button>
      </div>
      <div class="cart-sidebar-body d-flex flex-column justify-content-between">
        <ul class="cart-items">
          <li class="cart-item">
            <button type="button" class="btn btn-primary remove-btn">Close</button>
            <a href="#" class="thumbnail"><img src="assets/images/product-thumb-1.jpg" alt="product thumbnail"></a>
            <div class="cart-item-details d-flex flex-column justify-content-between">
              <h4><a href="#">Sample Pack of Flavor Powder</a></h4>
              <select class="custom-select qty-dropdown">
                <option>1</option>
                <option>2</option>
                <option>3</option>
                <option>4</option>
                <option>5</option>
                <option>6</option>
                <option>7</option>
                <option>8</option>
                <option>9</option>
                <option>10</option>
              </select>
              <div class="price-size text-right"><span>2 x .24</span>.48</div>
            </div>
          </li>
          <li class="cart-item">
            <button type="button" class="btn btn-primary remove-btn">Close</button>
            <a href="#" class="thumbnail"><img src="assets/images/product-thumb-2.jpg" alt="product thumbnail"></a>
            <div class="cart-item-details d-flex flex-column justify-content-between">
              <h4><a href="#">Sample Pack of Flavor Powder</a></h4>
              <select class="custom-select qty-dropdown">
                <option>1</option>
                <option>2</option>
                <option>3</option>
                <option>4</option>
                <option>5</option>
                <option>6</option>
                <option>7</option>
                <option>8</option>
                <option>9</option>
                <option>10</option>
              </select>
              <div class="price-size text-right"><span>2 x .24</span>.48</div>
            </div>
          </li>
          <li class="grand-total d-flex align-items-center justify-content-between">Total:<strong>$52.87</strong></li>
        </ul>
        <div class="body-sidebar-footer">
          <div class="cart-similar-item">
            <div class="wrap">
              <p>You might need this:</p>
              <div class="similar-item-thumb"><a href="#"><img src="assets/images/product-thumb-1.jpg" alt=""></a></div>
              <h4><a href="#">Acorn Flavored Powder, Natural (8 oz.)</a></h4>
              <a href="#" class="btn btn-primary">$14.70 - Add to Cart</a>
            </div>
          </div>
          <button type="button" class="btn btn-primary btn-block"><strong>$52.87 - Check Out</strong></button>
        </div>
      </div>
    </div>
  </aside>
  <!-- /.cart sidebar -->

  <!-- mobile search menu -->
  <div class="mobile-search-menu">
    <div class="search-wrap">
      <input type="text" class="form-control" placeholder="Search...">
    </div>
  </div>
  <!-- /.mobile search menu -->

  <!-- video modal -->
  <div class="modal fade video-modal">
    <div class="modal-dialog modal-lg modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">Video Title</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close"> <span
              aria-hidden="true">&times;</span> </button>
        </div>
        <div class="modal-body">
          <div class="embed-responsive embed-responsive-16by9">
            <iframe class="embed-responsive-item" src="https://www.youtube.com/embed/zpOULjyy-n8?rel=0"
              allowfullscreen></iframe>
          </div>
        </div>
      </div>
    </div>
  </div>
  <!-- /.video modal -->

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-element-bundle.min.js"></script>
  <script async src="https://www.instagram.com/embed.js"></script>
  <script src="assets/js/bootstrap.bundle.min.js"></script>
  <script src="assets/js/lightslider.js"></script>
  <script src="assets/js/slinky.js"></script>
  <script src="assets/js/aos.js"></script>

  <!-- Initialize animations -->
  <script>
    AOS.init();
  </script>

  <!-- For mobile menu -->
  <script>
    const slinky = $('#menu').slinky({ title: true });
  </script>
  <script>
    $(function () {
      $('[data-toggle="tooltip"]').tooltip()
    })
  </script>
  <script>
    $('.close-menu').on('click', function (e) {
      $('.mobile-menu').toggleClass("show");
      e.preventDefault();
    });
  </script>
  <script>
    $('.sub-menu > li').click(function (e) {
      e.stopPropagation();
      $(this).toggleClass('active');
      $(this).children('div').slideToggle();
      $(this).closest('.parent').siblings().children('div').slideUp();
    });
  </script>
  <script>
    $(document).ready(function () {
      $('#videos-slider').lightSlider({
        item: 2,
        loop: false,
        slideMove: 1,
        easing: 'cubic-bezier(0.25, 0, 0.25, 1)',
        speed: 600,
        slideMargin: 120,
        enableTouch: true,
        pager: false,
        onSliderLoad: function (el) {
          var parent = el.parent();
          var action = parent.find('.lSAction');
          action.insertBefore(parent);
        },
        responsive: [
          {
            breakpoint: 1199,
            settings: {
              slideMargin: 40,
            }
          },
          {
            breakpoint: 991,
            settings: {
              item: 2,
              slideMove: 1,
              slideMargin: 30
            }
          },
          {
            breakpoint: 575,
            settings: {
              item: 1,
              slideMargin: 20
            }
          }
        ]
      });
    });
  </script>
  <script>
    $(document).ready(function () {
      $('#blog-slider').lightSlider({
        item: 2,
        loop: false,
        slideMove: 1,
        easing: 'cubic-bezier(0.25, 0, 0.25, 1)',
        speed: 600,
        slideMargin: 120,
        enableTouch: true,
        pager: false,
        onSliderLoad: function (el) {
          var parent = el.parent();
          var action = parent.find('.lSAction');
          action.insertBefore(parent);
        },
        responsive: [
          {
            breakpoint: 1199,
            settings: {
              slideMargin: 40,
            }
          },
          {
            breakpoint: 991,
            settings: {
              item: 2,
              slideMove: 1,
              slideMargin: 30
            }
          },
          {
            breakpoint: 575,
            settings: {
              item: 1,
              slideMargin: 20
            }
          }
        ]
      });
    });  
  </script>
  <script>
    $(document).ready(function () {
      $('#reviews-slider').lightSlider({
        item: 3,
        loop: false,
        slideMove: 1,
        easing: 'cubic-bezier(0.25, 0, 0.25, 1)',
        speed: 600,
        slideMargin: 0,
        enableTouch: true,
        pager: false,
        onSliderLoad: function (el) {
          var parent = el.parent();
          var action = parent.find('.lSAction');
          action.insertBefore(parent);
        },
        responsive: [
          {
            breakpoint: 1199,
            settings: {
              item: 2,
              slideMove: 1,
            }
          },
          {
            breakpoint: 767,
            settings: {
              item: 1,
              slideMove: 1,
            }
          }
        ]
      });
    });  
  </script>
  <script>
    $('.nav-cart').on('click', function (e) {
      $('.nav-search').removeClass('active');
      $('.mobile-search-menu').removeClass('active');
      $('.mobile-menu').removeClass('show');
      $('.sidebar-menu-wrapper .overlay').removeClass('active');
      // actual function
      $('.mobile-menu-link').addClass('collapsed');
      $('.cart-sidebar').toggleClass("active");
      $('.nav-cart').toggleClass("active");
      $('.cart-sidebar-wrapper .overlay').toggleClass("active");
      $('body').removeClass("hide-scroll");
      e.preventDefault();
    });

    $('.close-sidebar-btn').on('click', function (e) {
      $('.nav-cart').toggleClass("active");
      $('.cart-sidebar').toggleClass("active");
      $('.cart-sidebar-wrapper .overlay').toggleClass("active");
      $('body').removeClass("hide-scroll");
      e.preventDefault();
    });

    $('.cart-sidebar-wrapper .overlay').on('click', function (e) {
      $('.nav-cart').toggleClass("active");
      $('.cart-sidebar').toggleClass("active");
      $('.cart-sidebar-wrapper .overlay').toggleClass("active");
      $('body').removeClass("hide-scroll");
      e.preventDefault();
    });
  </script>
  <script>
    $('.mobile-menu-link').on('click', function (e) {
      $('.nav-search').removeClass('active');
      $('.mobile-search-menu').removeClass('active');
      $('.nav-cart').removeClass('active');
      $('.cart-sidebar').removeClass('active');
      $('.cart-sidebar-wrapper .overlay').removeClass('active');
      $('body').removeClass("hide-scroll");
    });
  </script>
  <script>
    $('.nav-search').on('click', function (e) {
      if ($('.nav-cart').hasClass('active')) {
        $('.nav-cart').removeClass('active');
      }
      if ($('.cart-sidebar').hasClass('active')) {
        $('.cart-sidebar').removeClass('active');
      }
      if ($('.cart-sidebar-wrapper .overlay').hasClass('active')) {
        $('.cart-sidebar-wrapper .overlay').removeClass('active');
      }
      if ($('.mobile-menu').hasClass('show')) {
        $('.mobile-menu').removeClass('show');
      }
      $('.mobile-menu-link').addClass('collapsed');
      $('.mobile-search-menu').toggleClass("active");
      $('.nav-search').toggleClass("active");
      e.preventDefault();
    });
  </script>
  <script>
    $(document).ready(function () {
      var showChar = 360;
      var ellipsestext = "...";
      var moretext = "more";
      var lesstext = "less";
      $('.more').each(function () {
        var content = $(this).html();
        if (content.length > showChar) {
          var c = content.substr(0, showChar);
          var h = content.substr(showChar - 1, content.length - showChar);
          var html = c + '<span class="moreellipses">' + ellipsestext + '&nbsp;</span><span class="morecontent"><span>' + h + '</span>&nbsp;<a href="" class="morelink">' + moretext + '</a></span>';
          $(this).html(html);
        }
      });

      $(".morelink").click(function () {
        if ($(this).hasClass("less")) {
          $(this).removeClass("less");
          $(this).html(moretext);
        } else {
          $(this).addClass("less");
          $(this).html(lesstext);
        }
        $(this).parent().prev().toggle();
        $(this).prev().toggle();
        return false;
      });
    });
  </script>
  <script>
    $(document).ready(function () {
      $('#product-gallery').lightSlider({
        gallery: true,
        item: 1,
        loop: false,
        controls: false,
        slideMove: 1,
        easing: 'cubic-bezier(0.25, 0, 0.25, 1)',
        speed: 600,
        slideMargin: 0,
        enableTouch: true,
        pager: true,
        thumbItem: 3,
        responsive: [
          {
            breakpoint: 991,
            settings: {
              slideMove: 1,
              auto: true,
              loop: true,
            }
          },
        ]
      });
    });
  </script>
  <script>
    $('video').on('play', function (e) {
      $("#gallery-slider").carousel('pause');
    });
    $('video').on('stop pause ended', function (e) {
      $("#gallery-slider").carousel();
    });
  </script>
</body>
</html>
